<?xml version="1.0" encoding="utf-8"?>
<!--
    FISIERUL APP.CONFIG - Application Configuration File

    CE ESTE ACEST FISIER?
    Este fisierul de configurare al aplicatiei .NET Framework
    Contine setari care pot fi modificate FARA a recompila aplicatia
    La runtime, .NET citeste acest fisier si aplica setarile

    DE CE E IMPORTANT?
    1. Connection strings pentru baza de date (cel mai important!)
    2. Configurari Entity Framework
    3. Setari de runtime (.NET version, etc.)
    4. App settings custom (daca avem nevoie)

    STRUCTURA:
    1. configSections - declara sectiunile custom (entityFramework)
    2. startup - versiunea .NET runtime
    3. connectionStrings - string-urile de conexiune la DB
    4. entityFramework - configurari EF specific

    CUM SE FOLOSESTE?
    Se citeste automat la pornirea aplicatiei
    In cod, accesezi cu: ConfigurationManager.ConnectionStrings["nume"]

    NOTA IMPORTANTA PENTRU DB FIRST:
    Connection string-ul TREBUIE sa contina metadata pentru EDMX:
    metadata=res://*/Models.ECommerceModel.csdl|...ssdl|...msl
    Asta spune EF unde sa gaseasca schema (csdl), storage (ssdl) si mapping (msl)
-->
<configuration>

  <!-- SECTIUNEA configSections -->
  <!-- Aceasta sectiune TREBUIE sa fie PRIMA in configuration! -->
  <!-- Declara sectiuni custom folosite mai jos (entityFramework) -->
  <configSections>
    <!--
        Declaratia sectiunii entityFramework
        Spune .NET ca exista o sectiune numita "entityFramework"
        si ca Entity Framework stie cum sa o interpreteze

        type: Clasa care parseaza sectiunea
        EntityFrameworkSection din assembly-ul EntityFramework
    -->
    <section name="entityFramework"
             type="System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"
             requirePermission="false" />
  </configSections>

  <!-- SECTIUNEA startup -->
  <!-- Specifica versiunea .NET Framework pe care ruleaza aplicatia -->
  <startup>
    <!--
        supportedRuntime defineste versiunea runtime
        version="v4.0" = CLR version 4.0 (folosit de .NET 4.x)
        sku = Stock Keeping Unit, identifica versiunea exacta .NET Framework

        .NETFramework,Version=v4.7.2 inseamna ca aplicatia
        necesita .NET Framework 4.7.2 sau mai nou
    -->
    <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.7.2" />
  </startup>

  <!-- SECTIUNEA connectionStrings -->
  <!--
      ACEASTA ESTE SECTIUNEA CEA MAI IMPORTANTA!
      Contine string-urile de conexiune la baza de date

      Pentru DB First cu EDMX, connection string-ul are format special:
      1. metadata - caile catre fisierele schema/storage/mapping
      2. provider - provider-ul ADO.NET (SqlClient pentru SQL Server)
      3. provider connection string - conexiunea efectiva la DB
  -->
  <connectionStrings>
    <!--
        CONNECTION STRING PENTRU ENTITY FRAMEWORK DB FIRST

        EXPLICATIA COMPONENTELOR:

        name="ECommerceEntities"
        - Numele conexiunii, folosit in cod: new ECommerceEntities()
        - TREBUIE sa fie IDENTIC cu numele din DbContext

        metadata=res://*/Models.ECommerceModel.csdl|...
        - ACEASTA E CHEIA DB FIRST!
        - res://*/ = cauta in assembly-ul curent
        - Models.ECommerceModel = namespace-ul si numele modelului
        - .csdl = Conceptual Schema Definition Language (entitatile)
        - .ssdl = Store Schema Definition Language (tabelele SQL)
        - .msl = Mapping Specification Language (maparea entitati-tabele)
        - | (pipe) separa cele 3 fisiere

        provider=System.Data.SqlClient
        - Provider-ul ADO.NET pentru SQL Server
        - Asta spune EF sa foloseasca driver-ul SQL Server

        provider connection string="..."
        - Conexiunea efectiva la baza de date SQL Server
        - data source = serverul SQL (. = local, sau .\SQLEXPRESS)
        - initial catalog = numele bazei de date
        - integrated security = autentificare Windows (nu user/pass)
        - MultipleActiveResultSets = permite mai multe query-uri simultane
        - App=EntityFramework = identifica aplicatia in SQL Server

        &quot; = ghilimele escaped in XML
        - Connection string-ul interior e intre ghilimele
        - In XML, " se scrie &quot;

        providerName="System.Data.EntityClient"
        - IMPORTANT pentru DB First!
        - System.Data.EntityClient = provider-ul EF (nu SqlClient direct)
        - Asta spune .NET ca e un connection string pentru Entity Framework
    -->
    <add name="ECommerceEntities"
         connectionString="metadata=res://*/Models.ECommerceModel.csdl|res://*/Models.ECommerceModel.ssdl|res://*/Models.ECommerceModel.msl;provider=System.Data.SqlClient;provider connection string=&quot;data source=.;initial catalog=ECommerceDB;integrated security=True;MultipleActiveResultSets=True;App=EntityFramework&quot;"
         providerName="System.Data.EntityClient" />
  </connectionStrings>

  <!-- SECTIUNEA entityFramework -->
  <!--
      Configurari specifice Entity Framework 6
      Acestea controleaza comportamentul EF la runtime
  -->
  <entityFramework>
    <!--
        defaultConnectionFactory - fabrica default pentru conexiuni
        Se foloseste cand nu specificam explicit connection string

        LocalDbConnectionFactory creeaza conexiuni la LocalDB
        (versiunea lightweight de SQL Server pentru development)

        NOTA: Nu se foloseste in cazul nostru pentru ca avem
        connection string explicit in connectionStrings
    -->
    <defaultConnectionFactory type="System.Data.Entity.Infrastructure.LocalDbConnectionFactory, EntityFramework">
      <parameters>
        <!-- mssqllocaldb = instanta default LocalDB -->
        <parameter value="mssqllocaldb" />
      </parameters>
    </defaultConnectionFactory>

    <!--
        providers - lista provider-elor de baze de date suportate
        Fiecare provider stie cum sa genereze SQL pentru baza lui de date
    -->
    <providers>
      <!--
          Provider pentru SQL Server

          invariantName = identificatorul provider-ului ADO.NET
          System.Data.SqlClient = provider-ul standard pentru SQL Server

          type = clasa care implementeaza serviciile EF pentru acest provider
          SqlProviderServices din EntityFramework.SqlServer
      -->
      <provider invariantName="System.Data.SqlClient"
                type="System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer" />
    </providers>
  </entityFramework>

  <!-- SECTIUNEA appSettings (optionala) -->
  <!--
      Aici putem adauga setari custom ale aplicatiei
      Se acceseaza cu: ConfigurationManager.AppSettings["cheie"]

      Pentru acest proiect nu avem nevoie, dar le-am lasat comentate
      ca exemplu pentru viitor
  -->
  <!--
  <appSettings>
    <add key="DefaultPageSize" value="20" />
    <add key="EnableLogging" value="true" />
    <add key="LogFilePath" value="logs\app.log" />
  </appSettings>
  -->

</configuration>
